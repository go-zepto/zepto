(this["webpackJsonplinkeradmin-webapp"]=this["webpackJsonplinkeradmin-webapp"]||[]).push([[0],{468:function(e,n,t){self,e.exports=function(){"use strict";var e={297:function(e){e.exports=t(0)}},n={};function r(t){var o=n[t];if(void 0!==o)return o.exports;var i=n[t]={exports:{}};return e[t](i,i.exports,r),i.exports}r.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(n,{a:n}),n},r.d=function(e,n){for(var t in n)r.o(n,t)&&!r.o(e,t)&&Object.defineProperty(e,t,{enumerable:!0,get:n[t]})},r.o=function(e,n){return Object.prototype.hasOwnProperty.call(e,n)};var o={};return function(){r.d(o,{default:function(){return q}});var e=t(555),n=r.n(e),i=t(556),u=r.n(i),a=t(557),c=r.n(a),l=t(558),s=r.n(l),f=r(297),d=r.n(f),m=t(31),p=r.n(m),h=t(716),v=t(7),g=t(96),y=/(or_)?([_a-zA-Z0-9]+)_(eq|gt|gte|lt|lte|between|in|nin|like|nlike)/,_=function(e){var n={};return Object.keys(e).forEach((function(t){var r=y.exec(t);if(4===(null==r?void 0:r.length)){var o="or_"===r[1]?"or":"and",i=r[2],u=r[3],a={};a[i]={},a[i][u]=e[t],n.and||(n.and=[{}]),n.and[0][o]||(n.and[0][o]=[]),n.and[0][o].push(a)}})),n},C=function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:v.fetchUtils.fetchJson;return{getList:function(t,r){var o=_(r.filter),i=r.pagination,u=i.page,a=i.perPage,c={skip:(u-1)*a,limit:a,where:o},l={filter:JSON.stringify(c)},s="".concat(e,"/").concat(t,"?").concat((0,g.stringify)(l));return n(s).then((function(e){e.headers;var n=e.json;return{data:n.data,total:n.count}}))},getOne:function(t,r){var o="".concat(e,"/").concat(t,"/").concat(r.id);return n(o).then((function(e){return e.headers,{data:e.json}}))},getMany:function(t,r){var o={filter:JSON.stringify({id:r.ids})},i="".concat(e,"/").concat(t,"?").concat((0,g.stringify)(o));return n(i).then((function(e){return{data:e.json.data}}))},getManyReference:function(e,n){return Promise.resolve({})},update:function(t,r){return n("".concat(e,"/").concat(t,"/").concat(r.id),{method:"PUT",body:JSON.stringify(r.data)}).then((function(e){return{data:e.json}}))},updateMany:function(e,n){return Promise.resolve({})},create:function(t,r){return n("".concat(e,"/").concat(t),{method:"POST",body:JSON.stringify(r.data)}).then((function(e){return{data:e.json}}))},delete:function(e,n){return Promise.resolve({})},deleteMany:function(e,n){return Promise.resolve({})}}},k=function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:v.fetchUtils.fetchJson;return{login:function(t){return n("".concat(e),{method:"POST",body:JSON.stringify(t)}).then((function(e){var n=e.json;console.log(n),localStorage.setItem("auth_token",n.token.value)}))},checkError:function(e){var n=e.status;return 401===n||403===n?(localStorage.removeItem("auth"),Promise.reject()):Promise.resolve()},checkAuth:function(e){return null!==localStorage.getItem("auth_token")?Promise.resolve():Promise.reject()},logout:function(){return n("".concat(e,"/logout"),{method:"POST"}).then((function(){localStorage.removeItem("auth_token")}))},getIdentity:function(){return Promise.resolve({})},getPermissions:function(e){return Promise.resolve()}}},E=function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};n.headers||(n.headers=new Headers({Accept:"application/json"}));var t=localStorage.getItem("auth_token");return null!==t&&""!==t&&n.headers.set("Authorization","Bearer ".concat(t)),h.fetchUtils.fetchJson(e,n)},R=function(e){return d().createElement(h.Admin,{dataProvider:C("/api",E),authProvider:k("/auth",E),layout:e.layout},e.resComponents)},b=t(132),w=r.n(b);function S(e,n){(null==n||n>e.length)&&(n=e.length);for(var t=0,r=new Array(n);t<n;t++)r[t]=e[t];return r}var I=["title","name","first_name","full_name"],P=function(e){if(0===e.list_endpoint.fields.length)return null;var n,t=e.list_endpoint.fields.map((function(e){return e.name})),r=function(e,n){var t;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(t=function(e,n){if(e){if("string"==typeof e)return S(e,n);var t=Object.prototype.toString.call(e).slice(8,-1);return"Object"===t&&e.constructor&&(t=e.constructor.name),"Map"===t||"Set"===t?Array.from(e):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?S(e,n):void 0}}(e))||n&&e&&"number"==typeof e.length){t&&(e=t);var r=0,o=function(){};return{s:o,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,u=!0,a=!1;return{s:function(){t=e[Symbol.iterator]()},n:function(){var e=t.next();return u=e.done,e},e:function(e){a=!0,i=e},f:function(){try{u||null==t.return||t.return()}finally{if(a)throw i}}}}(I);try{for(r.s();!(n=r.n()).done;){var o=n.value;if(t.includes(o))return o}}catch(e){r.e(e)}finally{r.f()}return null},x=t(705),G=r.n(x),F=t(711),O=t(101),j=r.n(O),T=t(45),N=r.n(T),L=t(22),A=function(e){var n=e.recordID,t=(0,v.useRedirect)(),r=(0,f.useState)([]),o=G()(r,2),i=o[0],u=o[1],a=(0,v.useDataProvider)();(0,f.useEffect)((function(){var t={};t["".concat(e.refResourceFieldName,"_eq")]=n,a.getList(e.resource.endpoint,{filter:t,pagination:{page:1,perPage:10},sort:{field:"id",order:"ASC"}}).then((function(e){u((null==e?void 0:e.data)||[])}))}),[a,e.refResourceFieldName,e.resource.endpoint,n,u]);var c=e.resource.list_fields.map((function(e){return{field:e.name,headerName:e.options.label,flex:"id"===e.name?.3:1}}));return d().createElement("div",{style:{height:400,width:"100%",marginBottom:"32px"}},d().createElement(F.DataGrid,{rows:i,columns:c,pageSize:5,rowHeight:48,disableColumnMenu:!0,disableSelectionOnClick:!0,disableColumnSelector:!0,componentsProps:{toolbar:{resource:e.resource,refResourceFieldName:e.refResourceFieldName,recordID:n}},onRowClick:function(n){t("/".concat(e.resource.endpoint,"/").concat(n.row.id))},components:{Toolbar:function(e){var n={};return n[e.refResourceFieldName]=e.recordID,d().createElement("div",{style:{padding:"20px",borderBottom:"1px solid #e9e9e9",overflow:"auto"}},d().createElement("div",{style:{float:"left"}},d().createElement(N(),{variant:"h3",style:{fontSize:"20px"}},e.resource.name)),d().createElement("div",{style:{float:"right"}},d().createElement(j(),{size:"small",variant:"contained",color:"primary",component:L.Link,to:{pathname:"/".concat(e.resource.endpoint,"/create"),state:{record:n}}},"Create")))}}}))},D=r(297),J=r(297),M={text:{fieldCompGen:function(e,n){return function(e){return J.createElement(h.TextField,e)}},inputCompGen:function(e,n){return function(e){return J.createElement(h.TextInput,e)}}},number:{fieldCompGen:function(e,n){return function(e){return d().createElement(h.NumberField,e)}},inputCompGen:function(e,n){return function(e){return d().createElement(h.NumberInput,e)}}},select:{fieldCompGen:function(e,n){return function(e){return D.createElement(h.TextField,e)}},inputCompGen:function(e,n){return function(e){return D.createElement(h.SelectInput,e)}}},datetime:{fieldCompGen:function(e,n){return function(e){return d().createElement(h.DateField,e)}},inputCompGen:function(e,n){return function(e){return d().createElement(h.DateTimeInput,e)}}},reference:{fieldCompGen:function(e,n){return function(t){var r=e.admin.resources.find((function(e){return e.name===n.options.ref_resource}));if(!r)return console.error('[ReferenceInput] Resource not found "'.concat(r,'"')),null;var o=n.options.text_field_name,i=o&&""!==o?o:P(r);return d().createElement(h.ReferenceField,w()({},t,{reference:null==r?void 0:r.endpoint}),d().createElement(h.TextField,{source:i}))}},inputCompGen:function(e,n){return function(t){var r=e.admin.resources.find((function(e){return e.name===n.options.ref_resource}));if(!r)return console.error('[ReferenceInput] Resource not found "'.concat(r,'"')),null;var o=n.options.option_text_field,i=n.options.autocomplete;return console.log(n),d().createElement(h.ReferenceInput,w()({},t,{reference:null==r?void 0:r.endpoint,filterToQuery:function(e){if(""===e)return{};var n={},t=P(r),o=i&&i.searchable_fields||[];return(o.length>0?o.length:null!=t?[t]:[]).forEach((function(t){n["or_".concat(t,"_like")]="%".concat(e,"%")})),n}}),i&&!i.enabled?d().createElement(h.AutocompleteInput,{optionText:o}):d().createElement(h.SelectInput,{optionText:o}))}}},reference_list:{fieldCompGen:function(e,n){return function(t){var r=e.resources.find((function(e){return e.name===n.options.ref_resource}));return r?d().createElement("div",null,"TODO: ReferenceListField"):(console.error('[ReferenceInput] Resource not found "'.concat(r,'"')),null)}},inputCompGen:function(e,n){var t=function(e,n){return function(t){var r=e.resources.find((function(e){return e.name===n.options.ref_resource}));if(!r)return console.error('[ReferenceInput] Resource not found "'.concat(r,'"')),null;var o=n.options.ref_resource_field_name;return d().createElement(A,{resource:r,refResourceFieldName:o,recordID:t.recordID})}}(e,n);return function(e){return d().createElement(t,w()({},e,{recordID:e.record.id}))}}}},U=function(){function e(n){var t;u()(this,e),this.fieldGenerators=M,this.schema=n.schema,this.defaultRowClick=null!==(t=n.defaultRowClick)&&void 0!==t?t:"edit"}return c()(e,[{key:"registerComponentGenerator",value:function(e,n){this.fieldGenerators[e]=n}},{key:"generateFieldComp",value:function(e){return this.fieldGenerators[e.type].fieldCompGen(this.schema,e)}},{key:"generateInputComp",value:function(e){return this.fieldGenerators[e.type].inputCompGen(this.schema,e)}},{key:"_generateResourceComps",value:function(e,n,t){var r=this;return e.map((function(e){var o=n(r.schema,e),i=e.options&&e.options.props||{};return d().createElement(o,w()({key:e.name,source:e.name},i,null==t?void 0:t.props))}))}},{key:"_generateShowResource",value:function(e){var n=this,t=e.list_endpoint.fields,r=this._generateResourceComps(t,(function(e,t){return n.generateFieldComp(t)}),{props:{addLabel:!0}});return function(e){return d().createElement(h.Show,e,d().createElement(h.SimpleShowLayout,null,r))}}},{key:"_generateListResource",value:function(e){var n=this,t=e.list_endpoint.fields,r=this._generateResourceComps(t,(function(e,t){return n.generateFieldComp(t)}));return function(e){return d().createElement(h.List,e,d().createElement(h.Datagrid,{rowClick:n.defaultRowClick},r))}}},{key:"_generateCreateResource",value:function(e){var n=this,t=e.create_endpoint.inputs,r=this._generateResourceComps(t,(function(e,t){return n.generateInputComp(t)}));return function(e){return d().createElement(h.Create,e,d().createElement(h.SimpleForm,null,r.map((function(e){return e}))))}}},{key:"_generateEditResource",value:function(e){var n=this,t=e.update_endpoint.inputs.length>0?e.update_endpoint.inputs:e.create_endpoint.inputs,r=this._generateResourceComps(t,(function(e,t){return n.generateInputComp(t)}));return function(e){return d().createElement(h.Edit,e,d().createElement(h.SimpleForm,null,r.map((function(e){return e}))))}}},{key:"generateResourceComp",value:function(e){var n=this._generateListResource(e),t=this._generateShowResource(e),r=this._generateCreateResource(e),o=this._generateEditResource(e);return d().createElement(h.Resource,{key:e.name,name:e.endpoint.toLowerCase(),list:n,show:"show"==this.defaultRowClick&&t||void 0,create:r,edit:o})}}]),e}(),z=(0,t(12).makeStyles)({menu:{padding:"8px"}}),B=function(e){var n=z();return d().createElement("div",{className:n.menu},e.children)},H=function(e){var n=function(e){var n;return 0===(null==e||null===(n=e.admin.menu)||void 0===n?void 0:n.links.length)?h.Menu:function(n){var t=n.onMenuClick,r=n.logout;return d().createElement(B,null,e.admin.menu.links.map((function(n,r){return function(n,r){var o,i=n.link_to_path.length>0?n.link_to_path:"/"+(null===(o=e.admin.resources.find((function(e){return e.name===n.link_to_resource_name})))||void 0===o?void 0:o.endpoint);return d().createElement(h.MenuItemLink,{sidebarIsOpen:!1,key:r,to:i,primaryText:n.label,leftIcon:d().createElement("span",{className:"material-icons"},n.icon||"list_view"),onClick:t})}(n,r)})),d().createElement(h.Responsive,{small:r}))}}(e);return function(e){return d().createElement(h.Layout,w()({},e,{menu:n}))}},q=function(){function e(n){var t=n.schemaPath,r=void 0===t?"/admin/_schema":t,o=n.target,i=void 0===o?"root":o,a=n.defaultRowClick;u()(this,e),this.schemaPath=r,this.target=i,this.defaultRowClick=null!=a?a:"edit"}var t;return c()(e,[{key:"registerComponentGenerator",value:function(e,n){}},{key:"init",value:(t=n()(s().mark((function e(){var n,t,r,o,i,u,a;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=document.getElementById(this.target),e.next=3,v.fetchUtils.fetchJson(this.schemaPath);case 3:t=e.sent;try{r=t.json,o=new U({schema:r,defaultRowClick:this.defaultRowClick}),i=r.admin.resources.map((function(e){return o.generateResourceComp(e)})),u=H(r),a=function(){return d().createElement(R,{resComponents:i,layout:u})},p().render(d().createElement(a,null),n)}catch(e){console.error(e)}case 5:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})}]),e}()}(),o.default}()},553:function(e,n,t){},717:function(e,n,t){"use strict";t.r(n);t(553);var r=function(e){e&&e instanceof Function&&t.e(3).then(t.bind(null,779)).then((function(n){var t=n.getCLS,r=n.getFID,o=n.getFCP,i=n.getLCP,u=n.getTTFB;t(e),r(e),o(e),i(e),u(e)}))},o=t(468),i=t.n(o),u=t(364),a=new i.a({target:"root",schemaPath:"/admin/_schema"}),c={fieldCompGen:function(e,n){return console.log(n,e),function(e){return Object(u.jsx)("div",{children:"Hello World!"})}},inputCompGen:function(e,n){return console.log(n,e),function(e){return Object(u.jsx)("div",{children:"Hello World!"})}}};a.registerComponentGenerator("color_picker",c),a.init(),r()}},[[717,1,2]]]);
//# sourceMappingURL=main.4b93b2c7.chunk.js.map